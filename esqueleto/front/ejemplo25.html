<!doctype html>
<html>
  <head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css"/>
    <link rel="stylesheet" type="text/css" href="estilo.css"/>

    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>

    <style>
      html, body {
        height: 100%;
        width: 100%;
        margin: 0;
        padding: 0;
      }

      #map {
        width: 100%;
        height: 100%;
      }

      .controls {
        padding: 20px;
        border-right: 2px solid black;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      .map-container {
        padding: 0;
      }

      .btn-custom {
        margin-bottom: 10px;
        width: 80%;
      }
    </style>
    <title>RXDET FINAL PROJECT</title>
  </head>
  <body>
    <div class="container-fluid h-100">
      <div class="row h-100">
        <!-- Panel de botones -->
        <div class="col-md-3 controls">
          <button id="btnDentro" class="btn btn-success btn-custom">Vacas Dentro</button>
          <button id="btnFuera" class="btn btn-danger btn-custom">Vacas Fuera</button>
          <button id="btnLimpiar" class="btn btn-secondary btn-custom">Limpiar Capas</button>
        </div>
        <div class="col-md-9 map-container">
        <div id="map"></div>
        </div>
      </div>
    </div>
    <!-- It is always a good idea to have different files for different purposes.--->
    <script type="text/javascript"> 

    const map = L.map('map')
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    map.setView([43.253, -7.34], 16);

    // A PARTIR DE AQUI, MODIFICAR EL CÓDIGO
    async function load_geom(type_of_cows){
      let url = `http://localhost:8000/geoms/${type_of_cows}`;
      const response = await fetch(url)
      const my_geom = await response.json();
      return my_geom;
    }

    async function main(){

      const vacas_dentro_geom = await load_geom("vacas_dentro");
      var vacas_dentro_layer = L.geoJson(vacas_dentro_geom);

      const vacas_fuera_geom = await load_geom("vacas_fuera");
      var vacas_fuera_layer = L.geoJson(vacas_fuera_geom);

      // Añadir botones
      // Botón Vacas Dentro
      document.getElementById('btnDentro').addEventListener('click', function() {
          if (map.hasLayer(vacas_dentro_layer)) {
              map.removeLayer(vacas_dentro_layer);
          } else {
              map.addLayer(vacas_dentro_layer);
          }
      });

      // Botón Vacas Fuera
      document.getElementById('btnFuera').addEventListener('click', function() {
          if (map.hasLayer(vacas_fuera_layer)) {
              map.removeLayer(vacas_fuera_layer);
          } else {
              map.addLayer(vacas_fuera_layer);
          }
      });

      // Botón Limpiar Capas
      document.getElementById('btnLimpiar').addEventListener('click', function() {
          if (map.hasLayer(vacas_dentro_layer)) {
              map.removeLayer(vacas_dentro_layer);
          }
          if (map.hasLayer(vacas_fuera_layer)) {
              map.removeLayer(vacas_fuera_layer);
          }
      });

    }

    main();

    </script>
  </body>
</html>